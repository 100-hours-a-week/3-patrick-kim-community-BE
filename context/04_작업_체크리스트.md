# PetStar 작업 체크리스트

> 이 문서는 Kakao Community → PetStar 리브랜딩 및 성능 최적화 작업의 진행 상황을 추적합니다.
>
> **중요**: 최적화 전 코드를 먼저 완성하고 Before 수치를 측정한 후, 단계별로 최적화를 적용합니다.

---

## 작업 워크플로우

### GitHub 이슈
- **Repository**: https://github.com/100-hours-a-week/3-patrick-kim-community-BE/issues
- 각 Phase 시작 전 이슈 생성 (gh cli 사용)

### 작업 순서 (매 Phase마다)

```
1. GitHub 이슈 확인
   └─ 해당 Phase 이슈가 있는지 확인
   └─ 없으면 gh issue create로 생성

2. 작업 진행
   └─ 이슈 번호 참조하여 커밋 (#이슈번호)

3. 작업 완료 시 (반드시 아래 순서로)
   └─ Claude 내부 TODO 업데이트 (TaskUpdate)
   └─ 체크리스트 문서 업데이트 (이 파일)
   └─ GitHub 이슈 close
```

### 세션 시작 시 (Claude에게)

```
1. 이 문서(04_작업_체크리스트.md) 읽기
2. 현재 진행 상황 파악
3. TaskCreate로 남은 작업 등록
4. GitHub 이슈 상태 확인 (gh issue list)
```

---

## GitHub 이슈 현황

| Phase | 이슈 번호 | 상태 |
|:------|:---------|:-----|
| Phase 0 | #14 | 완료 |
| Phase 1 | - | - |
| Phase 2 | - | - |
| Phase 3 | - | - |
| Phase 4 | - | - |
| Phase 5 | - | - |
| Phase 6 | - | - |
| Phase 7 | - | - |

---

## Phase 0: PetStar 리브랜딩 (최적화 전 버전)

> **목표**: 기본 기능만 구현. 의도적으로 최적화하지 않음.
>
> - N+1 문제 해결 X
> - 인덱스 최적화 X
> - 동시성 제어 X
> - Redis 캐싱 X

### 0-1. Enum 생성
- [x] `Species` (DOG, CAT, BIRD, FISH, RABBIT, HAMSTER, ETC)
- [x] `Gender` (MALE, FEMALE, UNKNOWN)
- [x] `ChallengeStatus` (UPCOMING, ACTIVE, ENDED)
- [x] `Role` (USER, ADMIN)

### 0-2. 신규 엔티티 생성
- [x] `Pet` 엔티티
- [x] `Challenge` 엔티티

### 0-3. 기존 엔티티 변경
- [x] `Entry` 엔티티 추가 (Post와 별도로 생성)
- [x] `Vote` 엔티티 추가 (PostLike와 별도로 생성)
- [x] `SupportMessage` 엔티티 추가 (Comment와 별도로 생성)
- [x] `Member`에 role, deletedAt 필드 추가

### 0-4. Repository 수정/생성
- [x] `PetRepository` 생성
- [x] `ChallengeRepository` 생성
- [x] `EntryRepository` 생성
- [x] `VoteRepository` 생성
- [x] `SupportMessageRepository` 생성

### 0-5. Service 수정/생성
- [x] `PetService` 생성
- [x] `ChallengeService` 생성
- [x] `EntryService` 생성
- [x] `VoteService` 생성
- [x] `SupportMessageService` 생성

### 0-6. Controller & API 경로 변경
- [x] `PetController` (`/api/v1/pets`)
- [x] `ChallengeController` (`/api/v1/challenges`)
- [x] `EntryController` (`/api/v1/entries`)
- [x] `SupportMessageController` (`/api/v1/supports`)

### 0-7. DTO 수정/생성
- [x] Pet Request/Response DTO
- [x] Challenge Response DTO
- [x] Entry Request/Response DTO
- [x] Vote Response DTO
- [x] SupportMessage Request/Response DTO

### 0-8. Mapper 생성
- [x] `PetMapper`
- [x] `ChallengeMapper`
- [x] `EntryMapper`
- [x] `SupportMessageMapper`

### 0-9. DB 마이그레이션
- [ ] `pet` 테이블 생성 (JPA 자동 생성)
- [ ] `challenge` 테이블 생성 (JPA 자동 생성)
- [ ] `entry` 테이블 생성 (JPA 자동 생성)
- [ ] `vote` 테이블 생성 (JPA 자동 생성)
- [ ] `support_message` 테이블 생성 (JPA 자동 생성)

---

## Phase 1: 부하테스트 환경 구축 & Before 측정

> **목표**: 최적화 전 베이스라인 수치 측정

### 1-1. k6 환경 구축
- [ ] k6 설치
- [ ] 테스트 시나리오 스크립트 작성

### 1-2. 테스트 데이터 시딩
- [ ] Member 10,000건
- [ ] Pet 15,000건
- [ ] Challenge 50건
- [ ] Entry 100,000건
- [ ] Vote 1,000,000건

### 1-3. Before 수치 측정
- [ ] 동시 50명 테스트
- [ ] 동시 100명 테스트
- [ ] 동시 500명 테스트

### 1-4. Before 수치 기록

| API | 응답시간 | 쿼리 수 | 비고 |
|:----|:--------|:-------|:-----|
| GET /challenges | ms | 개 | |
| GET /challenges/{id}/entries | ms | 개 | |
| GET /challenges/{id}/ranking | ms | 개 | |
| POST /entries/{id}/votes | ms | 개 | |

---

## Phase 2: DB 인덱스 최적화

> **목표**: Full Table Scan 제거

### 2-1. 쿼리 분석
- [ ] EXPLAIN으로 실행 계획 분석
- [ ] 병목 쿼리 식별

### 2-2. 인덱스 추가
- [ ] `idx_entry_challenge_id (challenge_id, id DESC)`
- [ ] `idx_entry_challenge_vote (challenge_id, vote_count DESC)`
- [ ] `idx_entry_pet_id (pet_id)`
- [ ] `idx_entry_member_id (member_id)`
- [ ] `uk_vote_entry_member (entry_id, member_id) UNIQUE`
- [ ] `idx_support_entry_id (entry_id, id DESC)`

### 2-3. After 수치 기록

| API | Before | After | 개선율 |
|:----|:-------|:------|:------|
| 랭킹 조회 | ms | ms | % |

---

## Phase 3: JPA 쿼리 최적화 (N+1 해결)

> **목표**: API당 쿼리 수 3개 이하

### 3-1. N+1 문제 해결
- [ ] `@BatchSize` 글로벌 설정
- [ ] 참여작 목록: Fetch Join 적용
- [ ] 랭킹 조회: DTO Projection 적용
- [ ] 응원 메시지 목록: Fetch Join 적용

### 3-2. After 수치 기록

| API | Before 쿼리 수 | After 쿼리 수 | 개선율 |
|:----|:--------------|:-------------|:------|
| 참여작 목록 | 개 | 개 | % |

---

## Phase 4: 트랜잭션 & 동시성 제어

> **목표**: 데이터 정합성 100% 보장

### 4-1. 중복 투표 방지
- [ ] DB Unique 제약조건 확인
- [ ] `DataIntegrityViolationException` → 409 응답 처리

### 4-2. vote_count 정확성
- [ ] 원자적 UPDATE 쿼리 작성
- [ ] `@Modifying` 쿼리 적용

### 4-3. 동시성 테스트
- [ ] 100 스레드 동시 투표 테스트
- [ ] 데이터 정합성 검증

---

## Phase 5: 서버 코드 최적화

> **목표**: 응답 시간 추가 단축

### 5-1. 비동기 처리
- [ ] `@Async` 설정
- [ ] 알림 등 백그라운드 작업 분리

### 5-2. 커넥션 풀 최적화
- [ ] HikariCP 설정 조정
  - [ ] `maximum-pool-size: 20`
  - [ ] `minimum-idle: 5`
  - [ ] `connection-timeout: 30000`

### 5-3. 코드 최적화
- [ ] `getReferenceById()` 프록시 사용
- [ ] 불필요한 조회 제거

---

## Phase 6: Redis 캐싱 도입

> **목표**: 실시간 랭킹 10ms 이내

### 6-1. Redis 설정
- [ ] 의존성 추가
- [ ] Redis 설정 (application.yml)

### 6-2. 실시간 랭킹 (Sorted Set)
- [ ] `ranking:challenge:{challengeId}` 키 설계
- [ ] 투표 시 ZINCRBY
- [ ] 랭킹 조회 시 ZREVRANGE

### 6-3. 캐싱 적용
- [ ] 챌린지 목록: `@Cacheable` (TTL 5분)
- [ ] 참여작 상세: `@Cacheable` (TTL 10분)
- [ ] 캐시 무효화: `@CacheEvict`

---

## Phase 7: 최종 성능 검증 & After 측정

> **목표**: Before/After 비교 및 문서화

### 7-1. 최종 부하 테스트
- [ ] 동시 1,000명 테스트
- [ ] 10분 지속 테스트

### 7-2. 최종 수치 기록

| 지표 | Before | After | 개선율 |
|:----|:-------|:------|:------|
| 평균 응답 시간 | ms | ms | % |
| RPS | | | x |
| 에러율 | % | % | |
| 랭킹 조회 | ms | ms | % |

### 7-3. 이력서용 성과 요약
- [ ] 한 줄 요약 작성
- [ ] 기술별 성과 정리

---

## 작업 이력

| 날짜 | Phase | 작업 내용 | 비고 |
|:----|:------|:---------|:----|
| 2026-02-17 | - | 체크리스트 문서 생성 | |
| 2026-02-17 | 0 | Enum, Entity, Repository, Service, DTO, Mapper, Controller 생성 | GitHub #14 |
| 2026-02-17 | 0 | Phase 0 완료 - 커밋 3eaab4f | GitHub #14 closed |

